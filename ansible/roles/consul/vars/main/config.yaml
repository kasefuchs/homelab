---
# Consul ACL config.
consul_config_acl:
  enabled: true
  default_policy: "deny"
  enable_token_persistence: true

# Consul TLS config.
consul_config_tls:
  defaults:
    ca_file: "{{ (consul_config_cert_ca_dir, 'cluster.crt') | ansible.builtin.path_join }}"
    key_file: "{{ (consul_config_cert_entity_dir, 'agent.key') | ansible.builtin.path_join }}"
    cert_file: "{{ (consul_config_cert_entity_dir, 'agent.crt') | ansible.builtin.path_join }}"

# Directory where Consul config files will be stored.
consul_config_dir: /etc/consul

# Directory for additional Consul config.
consul_config_include_dir: "{{ (consul_config_dir, 'conf.d') | ansible.builtin.path_join }}"

# Directory where Consul data will be stored.
consul_config_state_dir: /var/lib/consul

# Full path to the main Consul config file.
consul_config_file: "{{ (consul_config_include_dir, 'config.hcl') | ansible.builtin.path_join }}"

# Full path to the Vault secrets Consul config file.
consul_config_vault_file: "{{ (consul_config_include_dir, 'vault.hcl') | ansible.builtin.path_join }}"

# Directory where Consul certificate files will be stored in the config path.
consul_config_cert_dir: "{{ (consul_config_dir, 'certs') | ansible.builtin.path_join }}"

# Directory where Consul CA certificate files will be stored in the config path.
consul_config_cert_ca_dir: "{{ (consul_config_cert_dir, 'ca') | ansible.builtin.path_join }}"

# Directory where Consul entity certificate files will be stored in the config path.
consul_config_cert_entity_dir: "{{ (consul_config_cert_dir, 'entity') | ansible.builtin.path_join }}"

# Pebble service layer definition for the Consul service.
consul_config_pebble_layer:
  services:
    consul:
      override: replace
      startup: enabled
      command: "{{ consul_install_binary_file }} agent -config-dir={{ consul_config_include_dir }}"
      user: "{{ consul_install_user }}"
      group: "{{ consul_install_group }}"
      requires: [coredns, vault-agent]
      after: [coredns, vault-agent]

# Path to the Pebble layer file that contains the Consul service config.
consul_config_pebble_layer_file: "{{ (pebble_config_layer_dir, '005-consul.yaml') | ansible.builtin.path_join }}"
