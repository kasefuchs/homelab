datacenter = "{{ consul_datacenter }}"
data_dir   = "{{ consul_data_dir }}"

bind_addr   = "{{ tailscale_ip.stdout }}"
client_addr = "127.0.0.1"

addresses {
  http = "127.0.0.1 {{ tailscale_ip.stdout }}"
}

retry_join = [
{% for ip in hostvars | community.general.json_query('* | [?consul_server].tailscale_ip.stdout') %}
  "{{ ip }}",
{% endfor %}
]

{% if consul_encrypt -%}
encrypt = "{{ consul_encrypt }}"
{% endif %}

ui_config {
  enabled = {{ consul_ui_enabled | lower }}
}
