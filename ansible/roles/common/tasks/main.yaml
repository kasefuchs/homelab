---
- name: "Find all roles in the project"
  tags: always
  run_once: true
  register: common_roles_result
  delegate_to: localhost
  ansible.builtin.find:
    paths: "{{ (role_path, '..') | ansible.builtin.path_join | ansible.builtin.realpath }}"
    depth: 1
    file_type: directory

- name: Load roles variables
  tags: always
  loop: "{{ common_roles_result.files }}"
  run_once: true
  delegate_to: localhost
  failed_when: false
  loop_control:
    label: "{{ item.path | ansible.builtin.basename }}"
  ansible.builtin.include_vars:
    dir: "{{ (item.path, 'vars') | ansible.builtin.path_join | ansible.builtin.realpath }}"
