---
- name: Download Consul
  tags: download
  ansible.builtin.include_tasks:
    file: download.yaml
    apply:
      tags: download
      become: false
      run_once: true
      delegate_to: localhost

- name: Install Consul
  tags: install
  ansible.builtin.include_tasks:
    file: install.yaml
    apply:
      tags: install

- name: Create Consul certificates
  tags: certificate
  ansible.builtin.include_tasks:
    file: certificate.yaml
    apply:
      tags: certificate
      become: false
      delegate_to: localhost

- name: Configure Consul
  tags: config
  ansible.builtin.include_tasks:
    file: config.yaml
    apply:
      tags: config
      notify:
        - Reload SystemD daemon
        - Enable Consul service
        - Restart Consul service
        - Wait for Consul
