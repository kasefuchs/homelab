---
- name: Download Vault
  tags: download
  ansible.builtin.include_tasks:
    file: download.yaml
    apply:
      tags: download
      become: false
      run_once: true
      delegate_to: localhost

- name: Install Vault
  tags: install
  ansible.builtin.include_tasks:
    file: install.yaml
    apply:
      tags: install

- name: Create Vault certificates
  tags: certificate
  ansible.builtin.include_tasks:
    file: certificate.yaml
    apply:
      tags: certificate
      become: false
      delegate_to: localhost

- name: Setup Vault server
  tags: server
  block:
    - name: Create Vault server certificates
      tags: certificate
      ansible.builtin.include_tasks:
        file: server/certificate.yaml
        apply:
          tags:
            - server
            - certificate
          become: false
          delegate_to: localhost
